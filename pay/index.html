<!DOCTYPE html>
<html>
<head>
  <!--<script src="deeplink.js"></script>-->
</head>
<body>
  <div id="root">
    this is test for web-payment api
  </div>
  <script>
    //deeplink.createBrowser();
    Notification.requestPermission().then((permission) => {
      console.log(permission);
    }).catch((error) => {
      console.log(error);
    });
    
    var unregiHandler = function (resolve) {
      console.log("unregister success!");
      return Promise.resolve("success");
    }
    var unregiErrHandler = function (error) {
      console.log("unregister failed! " + error);
      return Promise.resolve("success");
    }
    
    var unregiLists = [];
    
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for(var i in registrations) {
          console.log(JSON.stringify(registrations[i])  + "in registrations");
          unregiLists.push(registrations[i].unregister().then(unregiHandler).catch(unregiErrHandler));
        }
      });
      Promise.all(unregiLists).then(() => {
        navigator.serviceWorker.register('sw.js', {scope: './pay'}).then((registration) => {
          registration.update().then((success) => {
            console.log("update success!" + success);
            const pm = registration.paymentManager;
            const pi = pm.paymentInstruments;
            console.log(pm);
            console.log(pi);
          }).catch((error) => {
            console.log("update failed! " + error);
          });
        });
      });
    } else {
      alert('serviceWorker is not supperted!'); 
    }  
  </script>
</body>
</html>
